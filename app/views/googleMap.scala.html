@import scala.collection.immutable
@import models.Facility
@import models.Defaults

@(lastLat : Option[scala.Float], lastLon : Option[scala.Float], lastZoom : Float, myLocation: Option[(scala.Float,scala.Float)], foundIPLocation : Boolean = false)

@main("MapTest") {
<h1>Test the map!</h1>

<div>
    <div id="map"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        window.findFacilities = false;

        @if(myLocation.isDefined){
            @Html(s"""
              window.findFacilities = true;
              var myX       = ${myLocation.get._2};
              var myY       = ${myLocation.get._1};
              """)
        }

        //These are used to center the map around a specified position on initialization. If no location has been
        //specified or retrieved, the map will try to center around the user's IP position.
        var lastLon        = @lastLon.getOrElse(0);
        var lastLat        = @lastLat.getOrElse(0);
        var lastZoom       = @lastZoom;
        var defaultLimit   = @Defaults.limit;
        var defaultRadius  = @Defaults.radius;

    </script>
    <script src="/assets/javascripts/googlemap.js"></script>
    <script src="/assets/javascripts/geolocation.js"></script>

    <!--If no position has been specified, center the map around the user's IP position.-->
    @if(!foundIPLocation && lastLon.isEmpty && lastLat.isEmpty){
        <script>CenterMyPosition(true);</script>
    }

    <p>
        <label for="teetime">Teetime:</label>
        <input type="text" id="teetime" readonly style="border:0; color:white; background-color:black;">
        <input type="hidden" id="time-low">
        <input type="hidden" id="time-high">
    </p>
    <div id="slider-range"></div>
    <hr>

    <!--form action="#" method="GET"-->
        <p>Search by address/location</p>
        <input name="address" placeholder="Golfstreet 777, USA" id="address" required>
        <p>Max distance in kilometers</p>
        <input name="radius"  type="number" id="georadius" value="15" required><br><br>
        <input name="submit"  type="submit" id="geocoder" value="Search">
    <!--/form-->
    <hr>
    <div id="allow-geo">
        <p>Allow us to search for facilities near you.</p>
        <button onclick="geoFindMe();" type="button">Allow</button>
    </div>

    <form action="#" method="GET" id="geo-form">
        <p>Search by your current location</p>
        <p>Max distance in kilometers</p>
        <input name="radius"     type="number" value="15"    required><br><br>
        <input id="geolatitude"  name="geolat" type="hidden" required>
        <input id="geolongitude" name="geolon" type="hidden" required>
        <input id="last-lat"     name="lat"    type="hidden">
        <input id="last-lon"     name="lon"    type="hidden">
        <input                   name="zoom"   type="hidden" value="7">
        <input name="submit"  type="submit" value="Search">
        <script>getCoords();</script>
    </form>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAuNX3q4tleOgFYfculRieQCZ4mVhbH0oA&callback=initMap"> </script>
</div>

}
